---
title: "Jetbot ROS2 #4: Continue setup including Xavier"
layout: rkjnote
author_profile: true
tags: [ros2, jetbot]
date: 2022-04-07
---

## Xavier setup

Previously I learned how to flash the Xavier, and reflashed both the emmc image as well as the ssd. Now I am running from the SSD. I need to do a standard configuration of it.

Things I did:
- Disabled screen blank and lock
- Copied .ssh from uburog
- Added github to .ssh/config
- added stuff to .bashrc
- cloned bdbd2_ws
- added kent to docker group
- install python3-pip
- install jetson-stats


Now I am trying to get pytorch working as a dockerfile.

There are jetson images at https://developer.nvidia.com/embedded/jetson-cloud-native which are supposed to work. But when I tried to install the pytorch container images, they do not work.```python3``` then ```import torch``` fails with a missing cuda-related library.

Docs claim that the jetpack release must be the same between container and device. They werent. the container is 4.6.1 while the device SSD was 4.6. I doubt if that is the issue, but I am reinstalling the OS on the device to 4.6.1 (using the sdkmanager rather than the jetson hacks scripts).

### The answer

Turns out, it was not the 4.6.1 that was key. What was key was adding --runtime nvidia in the ```docker run``` command.

Now I have torch on xaview docker - but I cannot see cuda :(

I created a base container, now I will install torch per https://forums.developer.nvidia.com/t/pytorch-for-jetson-version-1-10-now-available/72048  No per https://elinux.org/Jetson_Zoo#PyTorch_.28Caffe2.29

Nope. I followed the instructions from https://github.com/dusty-nv/jetson-containers to run, cuda IS available! Playing more with my stuff, it seems like cuda fails for a non-root user. Why?

From https://forums.developer.nvidia.com/t/nvidia-docker-seems-unable-to-use-gpu-as-non-root-user/80276/4 it seems that the user must be a member of the group video. Tested and it works. Modifying the build files now.

I wanted to try power modes. See https://docs.nvidia.com/jetson/l4t/index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/power_management_jetson_xavier.html for a chart. Doc change modes, use: ```sudo nvpmodel -m 8``` to change to mode 8, and ```sudo nvpmodel -q``` to see the current mode.
 